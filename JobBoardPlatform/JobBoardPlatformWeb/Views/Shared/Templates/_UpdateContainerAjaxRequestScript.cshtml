@using JobBoardPlatform.BLL.Search;
@using JobBoardPlatform.PL.Controllers.Offer;
@using JobBoardPlatform.PL.Controllers.Templates;

<!--sendRequestAndUpdateElement(url, elementId, callback)-->
@await Html.PartialAsync("./Templates/_UpdateHtmlElementAjaxRequestScript")

<script>
    function refreshCards(onSuccessCallback = null, isPageSwitched = false) {
        if (!isPageSwitched) {
            resetPageParameter();
        }
        const searchParams = new URLSearchParams(window.location.search)
        const refreshCardsAction = @Html.Raw(Json.Serialize(OfferCardsControllerBase.RefreshCardsContainerAction));;
        let refreshCards = refreshCardsAction;
        refreshCards += '?' + searchParams.toString();

        const cardContainerId = "cards-container";
        sendRequestAndUpdateElement(refreshCards, cardContainerId, onSuccessCallback);
    }

    function resetPageParameter() {
        const paramName = @Html.Raw(Json.Serialize(OfferSearchUrlParameters.Page));
        updateQueryStringParameter(paramName, 1);
    }

    function updateQueryStringParameter(key, value) {
        if (!('URLSearchParams' in window))
        {
            return;
        }

        var searchParams = new URLSearchParams(window.location.search)
        var newRelativePathQuery = window.location.pathname;

        if (value) {
            searchParams.set(key, value);
            newRelativePathQuery += '?' + searchParams.toString();
        }
        else {
            searchParams.delete(key);
            if (Array.from(searchParams).length > 0) {
                newRelativePathQuery += '?' + searchParams.toString();
            }
        }

        history.pushState(null, '', newRelativePathQuery);
    }
</script>
