@using JobBoardPlatform.BLL.Search;

<script>
    function refreshCards(onSuccessCallback = null, isPageSwitched = false) {
        if (!isPageSwitched) {
            resetPageParameter();
        }
        const searchParams = new URLSearchParams(window.location.search)
        const refreshCardsAction = "RefreshCardContainer";
        let refreshCards = refreshCardsAction;
        refreshCards += '?' + searchParams.toString();

        sendRequestAndUpdateContainer(refreshCards, onSuccessCallback);
    }

    function resetPageParameter() {
        const paramName = @Html.Raw(Json.Serialize(OfferSearchUrlParameters.Page));
        updateQueryStringParameter(paramName, 1);
    }

    function updateQueryStringParameter(key, value) {
        if (!('URLSearchParams' in window))
        {
            return;
        }

        var searchParams = new URLSearchParams(window.location.search)
        var newRelativePathQuery = window.location.pathname;

        if (value) {
            searchParams.set(key, value);
            newRelativePathQuery += '?' + searchParams.toString();
        }
        else {
            searchParams.delete(key);
            if (Array.from(searchParams).length > 0) {
                newRelativePathQuery += '?' + searchParams.toString();
            }
        }

        history.pushState(null, '', newRelativePathQuery);
    }

    function sendRequestAndUpdateContainer(url, onSuccessCallback) {
        console.log(url)
        $.ajax({
            url: url,
            method: 'POST',
            success: function (result) {
                updateContainer(result);
                if (onSuccessCallback != null) {
                    onSuccessCallback();
                }
            },
            error: function (xhr, status, error) {
                console.error(status);
                console.error(error);
            }
        });
    }

    function updateContainer(result) {
        const cardContainerId = "cards-container";
        const selector = `#${cardContainerId}`;
        const element = $(selector);
        element.html(result);
    }
</script>
