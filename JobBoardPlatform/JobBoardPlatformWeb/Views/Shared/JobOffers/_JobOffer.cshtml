@using JobBoardPlatform.DAL.Models.Enums;
@using System.Text.RegularExpressions;
@using JobBoardPlatform.PL.ViewModels.Offer.Users;

@model OfferCardViewModel
@{
    var offer = Model;
    bool isShowFull = false;
    if (ViewData.ContainsKey("IsFullCardDisplay"))
    {
        isShowFull = (bool)ViewData["IsFullCardDisplay"];
    }

    // TODO: move to utilities function
    string formattedCompanyName = Regex.Replace(offer.Company, @"\s+", "-").ToLower();
    string formattedOfferTitle = Regex.Replace(offer.JobTitle, @"\s+", "-").ToLower();
    string offerPageUrl = $"{formattedCompanyName}-{formattedOfferTitle}";
}

<a href="@Url.Action("Offer", "OfferContent", new { id=offer.Id, companyname=formattedCompanyName, offertitle=formattedOfferTitle })"
   class="card-body d-flex align-content-center border-0 bg-transparent text-decoration-none">
    <img src=@offer.CompanyImageUrl width="50" height="50" class="mx-2 border border-secondary rounded">
    <div class="d-flex flex-column mx-4 w-100">
        <div class="d-flex justify-content-between mb-2">
            <h5 class="mb-0">@offer.JobTitle</h5>
            <div class="d-flex">
                <div class="text-success mx-4 lead mb-0 text-center">@offer.SalaryDetails</div>
                <div class="rounded-pill border border-primary px-2 mb-0 justify-content-center align-self-center">
                    <p class="align-middle mb-0 small h-100">@offer.PublishedAgo</p>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-between">
            <div class="d-flex flex-row small">
                <div class="d-flex flex-row">
                    <i class="bi bi-buildings text-muted"></i>
                    <div class="mx-2 text-muted">@offer.Company</div>
                </div>
                <div class="d-flex flex-row mx-3">
                    <i class="bi bi-geo-alt text-muted"></i>
                    <div class="mx-2 text-muted">@offer.City, @offer.Country</div>
                </div>
                @if (isShowFull || offer.WorkLocationType == WorkLocationTypeEnum.FullyRemote.ToString())
                {
                <div class="text-center rounded-pill border border-primary bg-primary bg-opacity-10 px-2">
                    <p class="small mb-0 text-primary">@offer.WorkLocationType</p>
                </div>
                }
            </div>
            <div class="d-flex flex-row small">
                @if (offer.TechKeywords != null && offer.TechKeywords.Length > 0)
                {
                    @foreach (var technology in offer.TechKeywords)
                    {
                    <div class="text-center rounded-pill border border-dark border-opacity-25 px-2 ms-2">
                        <p class="small mb-0">@technology.ToLower()</p>
                    </div>
                    }
                }
            </div>
        </div>
    </div>
</a>